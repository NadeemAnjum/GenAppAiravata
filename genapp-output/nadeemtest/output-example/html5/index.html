<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>nadeemtest 2.0</title>
<style>

document
{  
    margin: 0;  
    padding: 0;  
}  

body {
background: rgb( 0,0,95 );
color: rgb( 220,210,210 );
}

.warning {
color: rgb( 255,0,0 );
}

.header1 {
font-size: 2em;
color: rgb( 228,255,250 );
}
.header2 {
font-size: 1.75em;
color: rgb( 228,255,250 );
}
.header3 {
font-size: 1.5em;
color: rgb( 228,255,250 );
}
.header4 {
font-size: 1.25em;
color: rgb( 228,255,250 );
}

.sidebar {
    position: absolute;
    left: 0;
    display: block;  
}

.sidebar ul {
   list-style-type: none;
   padding-left: 0;
}

/* .sidebar ul li + li {
  border-top: 1px dotted;
} */

.sidebar ul li {
   display: block;  
   width: 140px;  
   font-size: 18px;  
   line-height: 44px;  
   text-align: center;  
   vertical-align: middle;
   text-decoration: none;  
   color: rgb( 220,210,210 );
}

.sidebar ul li img {
   vertical-align: middle;
   float: right;
}

.sidebar ul li:hover {
   color: rgb( 200,128,0 );  
}

.config {
   vertical-align: middle;
   float: right;
}

.hoverhighlight {
   text-align: right;
}

.hoverhighlight:hover {
   color: rgb( 200,128,0 );  
}

#panelmain {
position: relative;
    display: block;  

}

a:link    {color: rgb( 228,255,250 );}
a:visited {color: rgb( 220,210,210 );}
a:hover   {color: rgb( 255,255,255 );}
a:active  {color: rgb( 200,128,0 );}

button {
  outline: none;
/*  cursor: none; */
  border: 0px;
  text-decoration: none;
  text-shadow: 0 1px 1px rgba(0,0,0,.3);
  border-radius: .2em;
  -webkit-border-radius: .2em; 
  -moz-border-radius: .2em;
  background-color: rgb( 228,255,250 );
  background: -webkit-gradient(linear, left top, left bottom, from( rgb( 228,255,250 ) ), to( rgb( 128,170,150 ) ));
  background: -moz-linear-gradient(top, rgb( 228,255,250 ),  rgb( 128,170,150 ) );
  filter:  progid:DXImageTransform.Microsoft.gradient(startColorstr=rgb( 128,170,150 ), endColorstr=rgb( 128,170,150 ));
  padding: 0;
  padding-left: 2px; 
  padding-right: 2px; 
}


button:hover {
/*   opacity: .5; */
   background-color: rgb( 255,255,255 );
   background: -webkit-gradient(linear, left top, left bottom, from( rgb( 255,255,255 ) ), to( rgb( 228,255,250 ) ));
    background: -moz-linear-gradient(top, rgb( 255,255,255 ),  rgb( 228,255,250 ) );
    filter:  progid:DXImageTransform.Microsoft.gradient(startColorstr=rgb( 228,255,250 ), endColorstr=rgb( 228,255,250 ));
/*   color: rgb( 255, 128, 0 );   */
}

button:active {
position: relative;
top: 1px;
left: 1px;
}

.box-shadow-menu { 
vertical-align:middle;
font-size: 2em;
}

.box-shadow-menu:hover { 
  color: rgb(200,128,0);
  stroke: rgb(200,128,0);
}

.svgmenu {
  color: rgb(220,210,210);
  stroke: rgb(220,210,210);
  padding: 5px;
}
.svgmenu:hover { 
  color: rgb(200,128,0);
  stroke: rgb(200,128,0);
}
.highlight:hover { 
  color: rgb(200,128,0);
}

.help {
    background-color: rgba(0,0,75, 0.95 );
    color: rgb(240,240,210);
    border-radius: .5em;
    box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.5);
    opacity: 0; /* Make it transparent */
    padding: .5em;
    position: absolute;
    text-decoration: none;
    visibility: hidden; /* and hidden */
/*    width: 25em; */
    z-index: 10;
}

.help_link_on:hover + span {
    opacity: 1;
    visibility: visible;
}

.modalDialog {
   position: fixed;
/*             font-family: Arial, Helvetica, sans-serif; */
   top: 0;
   right: 0;
   bottom: 0;
   left: 0;
   background: rgba(0,0,0,0.8);
   z-index: 99999;
   opacity:0;
   -webkit-transition: opacity 400ms ease-in;
   -moz-transition: opacity 400ms ease-in;
   transition: opacity 400ms ease-in;
   pointer-events: none;
}

.modalDialog_on {
   opacity:1;
   pointer-events: auto;
}

.modalDialog > div {
   width: 50%;
   position: relative;
   margin: 10% auto;
   padding: 5px 20px 13px 20px;
   border-radius: 10px;
   background: rgb( 0,0,95 );
   background: -moz-linear-gradient(rgb( 0,0,95 ), #222);
   background: -webkit-linear-gradient(rgb( 0,0,95 ), #222);
   background: -o-linear-gradient(rgb( 0,0,95 ), #222);
}

.close {
   background: #606061;
   color: #FFFFFF;
   line-height: 25px;
   position: absolute;
   right: -12px;
   text-align: center;
   top: -10px;
   width: 24px;
   text-decoration: none;
   font-weight: bold;
   -webkit-border-radius: 12px;
   -moz-border-radius: 12px;
   border-radius: 12px;
   -moz-box-shadow: 1px 1px 3px #000;
   -webkit-box-shadow: 1px 1px 3px #000;
   box-shadow: 1px 1px 3px #000;
}

.close:hover { background: #00d9ff; }

</style>
<script src="js/jquery-1.11.0.min.js"></script>
<script src="js/jquery.flot-0.8.1.min.js"></script>
<script src="js/uuid.min.js"></script>
<script src="js/autobahn.min.js"></script>
<link rel="stylesheet" href="css/jstree.min.css">
<script src="js/jstree.min.js"></script>
</head>
<header>
<table width=100%> <tr>
<td> <span id="menuspan" onclick="menuOnOff(event);" class="box-shadow-menu"> 
  <svg class="svgmenu" width="20" height="20" stroke-width="2.7">
    <path d="M0,1.5 20,1.5" />
    <path d="M0,9.5 20,9.5" />
    <path d="M0,17.5 20,17.5" />
  </svg>
  <span id="seabug" height=50px></span>
 </span></td>
<td><h2>nadeemtest 2.0</h2></td>
<td align=right >
  <table>
    <tr>
    <td>
    <table cellspacing="0" cellpadding="0">
      <tr><td><div id="sel_project"></div></td></tr>
      <tr><td><div id="login" class="hoverhighlight"></div></td></tr>
      <tr><td><div id="register" class="hoverhighlight"></div></td></tr>
      <tr><td><div id="logoff" class="hoverhighlight"></div></td></tr>
      <tr><td><div id="hoverhelp" class="hoverhighlight"></div></td></tr>
    </table>
    </td>
    <td>
    <table cellspacing="0" cellpadding="0">
      <tr>
      <td><img src="etc/files.png" width=40px id="files" class="config"></td>
      <td><div id="userconfig"><img src="etc/config.png" width=40px id="config" class="config"></div></td>
      </tr>
    </table>
    </td>
    </tr>
  </table>
</td>
</tr>
</table>
<div id="openModal" class="modalDialog">
   <div>
      <span id="closeModal" class="close">X</span>
      <div id="configbody"></div>
   </div>
</div>
</header>
<body>

<div id="global_data"> </div>
<div id="_state"> </div>
<script> 
                         
Object.size = function(obj) {

    var size = 0, key;
    for (key in obj) {
        if (obj.hasOwnProperty(key)) size++;
    }

    return size;
};

gd = $( "#global_data" );

function setMsging()
{

   var ws = $( "#_state" ).data( "_ws" );
   if ( !ws )
   {
      console.log( "setMsging: ws not defined" );
      return;
   }

   var conn = $( '#_state' ).data( "_wssession" );
   if ( conn && conn.isOpen )
   {
      console.log( "setMsging: connection is already open" );
      return;
   }
    

   conn = new ab.Session( ws 
      , function() {            // Once the connection has been established

          $( '#_state' ).data( "_wssession", conn );
        }
      , function() {            // When the connection is closed
            console.warn('setMsging connection closed');
        }
      , {                       // Additional parameters, we're ignoring the WAMP sub-protocol for older browsers
            'skipSubprotocolCheck': true
        }
    );


}        

function subMsging( vuuid, onevent )
{
   console.log( "subMsging: " + vuuid );
   var ws = $( "#_state" ).data( "_ws" );
   if ( !ws )
   {
      console.log( "subMsging: ws not defined" );
      return;
   }

   var conn = $( '#_state' ).data( "_wssession" );
   if ( !conn )
//   if ( conn && !conn.isOpen )
   {
      console.log( "subMsging: connection is not open" );
      return;
   }

   conn.subscribe( vuuid, onevent );
// this doesn't work:
// .then( function( subscription ) { $( '#_state' ).data( "_wssub:" + vuuid, subscription ) } );
}

function unsubMsging( vuuid )
{
   console.log( "unsubMsging: " + vuuid );
   var ws = $( "#_state" ).data( "_ws" );
   if ( !ws )
   {
      console.log( "subMsging: ws not defined" );
      return;
   }

   var conn = $( '#_state' ).data( "_wssession" );
   if ( !conn )
//   if ( conn && !conn.isOpen )
   {
      console.log( "subMsging: connection is not open" );
      return;
   }

   conn.unsubscribe( vuuid );
   $( '#_state' ).data( "_wssub:" + vuuid, null );
}

function msgGenericEvent( vuuid, data )
{
   console.log( 'msgGenericEvent ' + vuuid + ' : ' + data.json);
}

function getSid()
{
$.ajax({
url: "ajax/sys_uid.php",
cache: false
})
.done( function( data, status, xhr ) {
  $.each(data, function(k, v) {

//  if ( k == "_sid" )
//   {
//     $( "#global_data" ).data( "sid", v );
//   } 
   if ( k == "_ws" )
   {
     $( "#_state" ).data( "_ws", v );
     setMsging();
   }
 }); 
});
}

getSid();

function checkFloat( tag )
{

   var t = $( tag );
   var fieldValue=t.val();
   if ( isNaN( fieldValue ) )
   {
       t.val( t.prop( "defaultValue" ) );
       $( tag + "_msg" ).html( " not a valid floating point number, reset to default" );
   } else {
       if ( fieldValue < parseFloat ( t.attr( "min" ) ) )
       { 
           t.val( t.attr( "min" ) );
           $( tag + "_msg" ).html( " value set to minimum allowed" );
       } else {
           if ( fieldValue > parseFloat ( t.attr( "max" ) ) )
           { 
               t.val( t.attr( "max" ) );
               $( tag + "_msg" ).html( " value set to maximum allowed" );
           } else {
               $( tag + "_msg" ).html( "" );
           }
       } 
   }
}


gd.data( "_plot_options", 
 {
   font : {
             color : "rgb( 220,210,210 )"
          },
//   grid : {
//             color : "rgb( 220,210,210 )",
//             boarderWidth : 0.5
//          },
   xaxis : {
//             color : "rgb( 220,210,210 )",
             color : "gray",
             lineWidth : 0.5,
             font : {
                 color : "rgb( 220,210,210 )"
             }
          },
   yaxis : {
//             color : "rgb( 220,210,210 )",
             color : "gray",
             lineWidth : 0.5,
             font : {
                 color : "rgb( 220,210,210 )"
             }
          },
   lines: { 
            lineWidth : 1.0
          } 
} );

function checkMatch( tag1, tag2 )
{

   if ( $( tag1 ).val() != $( tag2 ).val() )
   {
      $( tag1 + "_msg" ).html( " does not match" );
   } else {
      $( tag1 + "_msg" ).html( "" );
   }
}
    
function checkInt( tag )
{

   var t = $( tag );
   var fieldValue=t.val();
   if ( isNaN( fieldValue ) )
   {
       t.val( t.prop( "defaultValue" ) );
       $( tag + "_msg" ).html( " not a valid number, reset to default" );
   } else {
       if ( fieldValue < parseInt ( t.attr( "min" ) ) )
       { 
           t.val( t.attr( "min" ) );
           $( tag + "_msg" ).html( " value set to minimum allowed" );
       } else {
           if ( fieldValue > parseInt ( t.attr( "max" ) ) )
           { 
               t.val( t.attr( "max" ) );
               $( tag + "_msg" ).html( " value set to maximum allowed" );
           } else {
               if ( parseInt( fieldValue ) != fieldValue )
               {   
                   $( tag + "_msg" ).html( " value rounded to nearset integer" );
                   t.val( parseInt( parseFloat( fieldValue ) + .5 ) );
               } else {
                   $( tag + "_msg" ).html( "" );
               }
           }
       }
   }
}

RegExp.quote = function(str) {
   return str.replace(/([.?*+^$[\]\\(){}|-])/g, "\\$1");
};

function clearPull( repeater )
{
   if ( !repeater || typeof( repeater ) != "string" || repeater.length == 0 || repeater == "#__fields:repeat__" )
   {
      repeater = "";
   }

   $( "#global_data" ).data( "_pull_json"   + repeater, {} );
   $( "#global_data" ).data( "_pull_update" + repeater, {} );
   $( "#global_data" ).data( "_pull_type"   + repeater, {} );
}

function toPull( pkg, tag, type, pulltag, repeater )
{

   if ( !repeater || typeof( repeater ) != "string" || repeater.length == 0 || repeater == "#__fields:repeat__" )
   {
      repeater = "";
   }

   var gd = $( "#global_data" );
   var tj = gd.data( "_pull_json"   + repeater );
   var tu = gd.data( "_pull_update" + repeater );
// for now, just set to 0
   tj[ pulltag ] = 0;
   if ( typeof( tu[ pulltag ] ) != "object" )
   {
      tu[ pulltag ] = {};
   }


   tu[ pulltag ][ tag ] = type;

   gd.data( "_pull_json"   + repeater, tj );
   gd.data( "_pull_update" + repeater, tu );


}

function doPull( repeater )
{
   if ( !repeater || typeof( repeater ) != "string" || repeater.length == 0 || repeater == "#__fields:repeat__" )
   {
      repeater = "";
   }

   var gd = $( "#global_data" );
   var s = $( '#_state' );
   var l = s.data( '_logon' );
   if ( l && l.length )
   {
      var tj = gd.data( "_pull_json" + repeater );
      tj[ '_logon' ] = l;

      if ( Object.size( tj ) )
      {

         $.getJSON( "ajax/sys_config/sys_pull.php", tj )
         .done( function( data, status, xhr ) {


            var tu = gd.data( "_pull_update" + repeater );
            $.each(data, function(k, v) {


               if ( typeof( tu[ k ] ) == "object" )
               {
                  $.each( tu[ k ], function( k2, v2 ) {

                     var t = $( k2 );
                     switch( v2 )
                     {
                        case "checkbox" : 
                         t.prop( "checked", v == "on" ); break;
                        case "email" : 
                        case "text" : 
                        case "integer" : 
                        case "float" : 
                         t.val( v ); break;
                        case "listbox" : 
                         t.empty();
// setup html for results


                         $.each( v, function( k3, v3 ) {

                           t.append($("<option></option>").attr( "value", v3 ).text( v3 ) );
                         });
                         break;
                        default : 
                         console.log( "not yet" );
                     }
                  });
               }
            });
         })
         .fail( function( xhr, status, errorThrown ) {

         });
      } else {

      }
   }
}

function resetHoverHelp() {
   if ( $( "#global_data" ).data( "hoverhelp" ) ||
        $( "#global_data" ).data( "hoverhelp" ) != 0 )
   {
       $( ".help_link" ).removeClass( "help_link_on" );
       $( ".help_link" ).addClass( "help_link_on" );
   }
}

function updateRepeats( pkg, tag )
{
   var t = $( tag );
   var fieldValue=t.val();

// now find all matching fields
// need to map all "repeat" back references
   var key = pkg + ":" + tag + ":repeat";
   var keyc = key + ":count";
   var lt = $( "#global_data" ).data( keyc );
   if ( lt == undefined )
   {
      $( "#global_data" ).data( keyc, fieldValue );
   } else {
      if ( lt == fieldValue )
      {

         return true;
      }
   }
   $( "#global_data" ).data( keyc, fieldValue );
      
   var h = $( "#global_data" ).data( key );
   var r = $( "#global_data" ).data( "repeats" );
   var re = $( "#global_data" ).data( "repeats_eval" );
   var out = "";
   var lk;
   var to_eval = "";
   for (var k in h) {
   // use hasOwnProperty to filter out keys from the Object.prototype
      if (h.hasOwnProperty(k)) {
         lk = k + '-span';
         break;
      }
   }

   var rxname = / name="(\w+)(["\[\]])/;
   var rxid  = / id="(\w+)"/;

   for ( var i = 1; i <= fieldValue; i++ )
   {
      for (var k in h) {
      // use hasOwnProperty to filter out keys from the Object.prototype
         if (h.hasOwnProperty(k)) {
   //         lk = k;

            var stag = RegExp.quote( k.replace( "#", "" ) );

            var idm = rxid.exec( r[k] );
            var idx;
            if ( idm )
            {
                idx = idm[ 1 ];                         
            }
            var namem = rxname.exec( r[k] );
            var namex = "";
            var namext = "";
            if ( namem )
            {
               namex = namem[ 1 ];
               namext = namem[ 2 ];
            }


            var this_out = r[k].replace( "</label>", "[" + i + "]</label>" );
            var this_eval = re[k];
            if ( namem )
            {
              this_out = this_out.replace( new RegExp( RegExp.quote( 'name="' + namex + namext ) ), 'name="' + namex + "-" + i + namext );
            }
            if ( idx )
            {
              this_out = this_out.replace( new RegExp( 'id="' + idx + '"' ), 'id="' + idx + "-" + i + '"' );
              this_out = this_out.replace( new RegExp( 'id="' + idx + '_msg"' ), 'id="' + idx + "-" + i + '_msg"' );
              this_out = this_out.replace( new RegExp( 'for="' + idx + '"' ), 'for="' + idx + "-" + i + '"' );

              this_eval = this_eval.replace( new RegExp( '"#' + idx + '"', "g" ), '"#' + idx + "-" + i + '"' );
              this_eval = this_eval.replace( new RegExp( ':' + idx + ':', "g" ), ':' + idx + "-" + i + ':' );
              this_eval = this_eval.replace( new RegExp( '"#' + idx + '_msg"', "g" ), '"#' + idx + "-" + i + '_msg"' );
            }
            out += this_out;
            to_eval += this_eval;
         }
      }
   }




   clearPull( tag );
   $( lk ).html( out );
   eval( to_eval );
   doPull( tag );
   resetHoverHelp();
}

function updateRepeatsLb( pkg, tag )
{
   var t = $( tag );
   var fieldValue= t.val();



// now find all matching fields
// need to map all "repeat" back references
   var key   = pkg + ":" + tag + ":repeat";
   var keylb = pkg + ":" + tag + ":" + fieldValue + ":repeat";
   var keyc = key + ":count";
   var lt = $( "#global_data" ).data( keyc );
   if ( lt == undefined )
   {
      $( "#global_data" ).data( keyc, fieldValue );
   } else {
      if ( lt == fieldValue )
      {
         return true;
      } else {
         $(tag + " > option").each(function() { 

            if ( this.value != fieldValue )
            {
               var hlt = $( "#global_data" ).data( pkg + ":" + tag + ":" + this.value + ":repeat" );
               for (var k in hlt) {
                  if (hlt.hasOwnProperty(k)) {
                     $( k + '-span' ).html( "" );
                     break;
                  }
               }
            }
         });
      }
   }

   $( "#global_data" ).data( keyc, fieldValue );
      
   var h = $( "#global_data" ).data( keylb );
   var out = "";
   var lk;
   var to_eval = "";
   for (var k in h) {
   // use hasOwnProperty to filter out keys from the Object.prototype
      if (h.hasOwnProperty(k)) {
         lk = k + '-span';
         break;
      }
   }

   var r = $( "#global_data" ).data( "repeats" );
   var re = $( "#global_data" ).data( "repeats_eval" );
   for (var k in h) {
      if (h.hasOwnProperty(k)) {
         out += r[k];
         to_eval += re[k];
      }
   }





   clearPull( tag );
   $( lk ).html( out );
   eval( to_eval );
   doPull( tag );
   resetHoverHelp();
}

function updateRepeatsCb( pkg, tag, rev )
{
   var t = $( tag );
   var fieldValue;
   if ( rev )
   {
     fieldValue = t.prop( "checked" ) ? 0 : 1;
   } else {
     fieldValue = t.prop( "checked" ) ? 1 : 0;
   }


// now find all matching fields
// need to map all "repeat" back references
   var key = pkg + ":" + tag + ":repeat";
   var keyc = key + ":count";
   var lt = $( "#global_data" ).data( keyc );
   if ( lt == undefined )
   {
      $( "#global_data" ).data( keyc, fieldValue );
   } else {
      if ( lt == fieldValue )
      {

         return true;
      }
   }
   $( "#global_data" ).data( keyc, fieldValue );
      
   var h = $( "#global_data" ).data( key );
   var out = "";
   var lk;
   var to_eval = "";
   for (var k in h) {
   // use hasOwnProperty to filter out keys from the Object.prototype
      if (h.hasOwnProperty(k)) {
         lk = k + '-span';
         break;
      }
   }

   if ( fieldValue == 1 )
   {
      var r = $( "#global_data" ).data( "repeats" );
      var re = $( "#global_data" ).data( "repeats_eval" );
      for (var k in h) {
         if (h.hasOwnProperty(k)) {
            out += r[k];
            to_eval += re[k];
         }
      }
   }




   clearPull( tag );
   $( lk ).html( out );
   eval( to_eval );
   doPull( tag );
   resetHoverHelp();
}

function addRepeat( pkg, tag, reftag )
{

   var key = pkg + ":" + reftag + ":repeat";
   var h = $( "#global_data" ).data( key );
   if ( h == undefined ) {
      h = new Object();
   }
   h[ tag ] = 1;
   $( "#global_data" ).data( key, h );
}

function setLastValue( pkg, tag, defval ) {
    var tl = pkg + ":" + tag + ":last_value";
    var dv = pkg + ":" + tag + ":default_value";
    var t = $( tag );

    if ( $( "#global_data" ).data( tl ) == undefined ) {
        switch( t.attr( "type" ) )
        {
            case "checkbox" :
            case "radio" :
                $( "#global_data" ).data( tl, t.is( ":checked") );
                $( "#global_data" ).data( dv, t.is( ":checked") ); break;
            case "div" : 
            case "msgs" : 
                $( "#global_data" ).data( tl, t.html() ); 
                $( "#global_data" ).data( dv, t.html() );
                break;
            case "plot2d" :

                           break;
            case "filelink" :
            case "filelinkm" :
                $( "#global_data" ).data( tl, $( tag + "_filelink" ).html() );

                break;

            default : 
                      if ( defval )
                      {

                         t.val( defval );
                      }                         
                      $( "#global_data" ).data( tl, t.val() );
                      $( "#global_data" ).data( dv, t.val() );
                      break;
        }
    } else {
        switch( t.attr( "type" ) )
        {
            case "checkbox": 
            case "radio": 
                   t.prop( "checked", $( "#global_data" ).data( tl ) ); break;
            case "div" : 
            case "msgs" : t.html( $( "#global_data" ).data( tl ) ); break;
            case "plot2d" : 

                     t.plot( $( "#global_data" ).data( tl ), gd.data( "_plot_options" ) ); break;
            case "filelink" : 
            case "filelinkm" : 
                     $( tag + "_filelink" ).html( $( "#global_data" ).data( tl ) );
                     break;
            default: t.val( $( "#global_data" ).data( tl ) ); break;
        }
    }


}

function saveLastValue( pkg, tag ) {
   var t = $( tag );

   switch( t.attr( "type" ) )
   {
       case "file" : console.log( "file set is insecure, skipped" ); return; break;
       case "checkbox" :
       case "radio" :
                     $( "#global_data" ).data( pkg + ":" + tag + ":last_value", t.is( ":checked") ); break;
       case "div" :
       case "msgs" : $( "#global_data" ).data( pkg + ":" + tag + ":last_value", t.html() ); break;
       case "plot2d" : 

                       break;
       case "filelink" : 
       case "filelinkm" : 
                     $( "#global_data" ).data( pkg + ":" + tag + ":last_value", $( tag + "_filelink" ).html() ); 
                     break;
       default: $( "#global_data" ).data( pkg + ":" + tag + ":last_value", t.val() ); break;
   }


}

function saveLastValues( pkg ) {

   $( "#" + pkg + " :input" ).each(function() {
      saveLastValue( pkg, "#" + $( this ).attr( "id" ) );
   });
}

function resetDefaultValue( pkg, tag ) {

   var t = $( tag );


   if(  t.prop( "tagName" ) == 'SELECT' ) {
    t.val( $( "#global_data" ).data( pkg + ":" + tag + ":default_value" ) );
   } else {
      switch( t.attr( "type" ) )
      {
          case "file" : console.log( "file set is insecure, skipped" ); return; break;
          case "checkbox" : 
          case "radio" : 
                        t.prop( "checked", $( "#global_data" ).data( pkg + ":" + tag + ":default_value" ) ); break;
          case "div" :
          case "msgs" : t.html( $( "#global_data" ).data( pkg + ":" + tag + ":default_value" ) ); 
                        break;
          case "filelink" :
          case "filelinkm" :
                        $( tag + "_filelink" ).html( " " );
                        break;
          case "plot2d" : 
                        $( "#global_data" ).data( pkg + ":" + tag + ":last_value", [[]] );
                        t.plot( [[]], gd.data( "_plot_options") ); break;
                        break;
          default: t.val( t.attr( "value" ) ); break;
      }
   }
   saveLastValue( pkg, tag );
   $( tag + "_msg" ).html("");
}

function resetDefaultValues( pkg ) {

   $( "#" + pkg + " :input" ).each(function() {
      resetDefaultValue( pkg, "#" + $( this ).attr( "id" ) );
   });
   var e = $( "#global_data" ).data( "_extra_resets" );
   for ( var i in e ) 
   {

      resetDefaultValue( pkg, "#" + e[i] );
   }
}

function setHoverHelp() {
   if ( !$( "#global_data" ).data( "hoverhelp" ) ||
        $( "#global_data" ).data( "hoverhelp" ) == 0 )
   {
       $( ".help_link" ).removeClass( "help_link_on" );
       $( "#hoverhelp" ).html( "Help off" );
   } else {
       $( ".help_link" ).addClass( "help_link_on" );
       $( "#hoverhelp" ).html( "Help on" );
   }
}

function setLogin() {
   if ( !$( "#global_data" ).data( "login" ) ||
        $( "#global_data" ).data( "login" ) == 0 )
   {
       $( "#login" ).html( "Logged in" );
   } else {
       $( "#login" ).html( "Logged off" );
   }
}
</script>

<nav class="sidebar toggle">
<ul>
<li id="tools">Tools<img src="pngs/tools.png" width=40px></li>
<li id="build">Build<img src="pngs/build.png" width=40px></li>
<li id="interact">Interact<img src="pngs/interact.png" width=40px></li>
<li id="simulate">Simulate<img src="pngs/simulate.png" width=40px></li>
<li id="calculate">Calculate<img src="pngs/calculate.png" width=40px></li>
<li id="analyze">Analyze<img src="pngs/analyze.png" width=40px></li>
</ul>
</nav>

<div id="panelmain" >
<p></p>
<div>
<script>
    var count = 0;
    var sidewidth = parseFloat( $( ".sidebar" ).css( "width" ) ) + 
                    parseFloat( $( ".sidebar" ).css( "padding-left" ) ) +
                    parseFloat( $( ".sidebar" ).css( "padding-right" ) ) +
                    parseFloat( $( ".sidebar" ).css( "border-left-width" ) ) +
                    parseFloat( $( ".sidebar" ).css( "border-right-width" ) ) +
                    parseFloat( $( ".sidebar" ).css( "margin-left" ) ) +
                    parseFloat( $( ".sidebar" ).css( "margin-right" ) )
    ;
    var speed = 400;
    $( "#panelmain" ).css( "left", count % 2 ? 0 : sidewidth );

    $( ".sidebar ul li" ).click( function() {








        var myTag = $( this ).attr( "id" );
        $( "#seabug" ).html( "<img height=50px style=\"vertical-align:middle\" id='" + myTag + "' src='pngs/" +  myTag + ".png'>" );
        $( "#panelmain" ).load( "ajax/" + myTag + ".html" );
        $( "#menuspan" ).trigger( "click" );
    } );

    function menuOnOff(event) {
        count++;
// __~debugcss{        // console.log( count % 2 ? "menuonoff true" : "menuonoff false" );}
        var ofs = count % 2 ? 0 : sidewidth;
        var wid = count % 2 ? '100%' : $("#panelmain").parent().parent().width() - sidewidth - 20;




        $( ".toggle" ).toggle( speed );
        $( "#panelmain" ).animate( {left: ofs, width: wid }, speed );
    }

    $( window ).resize(function() {
        var ofs = count % 2 ? 0 : sidewidth;
        var wid = count % 2 ? '100%' : $( "#panelmain" ).parent().parent().width() - sidewidth - 20;



        $( "#panelmain" ).css( "left", ofs ).css( "width", wid );
    } );

$( "#hoverhelp" ).click(function() {
   if ( !$( "#global_data" ).data( "hoverhelp" ) ||
        $( "#global_data" ).data( "hoverhelp" ) == 0 )
   {
       $( "#global_data" ).data( "hoverhelp", 1 );
   } else {
       $( "#global_data" ).data( "hoverhelp", 0 );
   }
   setHoverHelp();
});
setHoverHelp();

$( "#config" ).click( function() {
   var s = $( '#_state' );
   var l = s.data( '_logon' );
   if ( l && l.length )
   {
       $( "#configbody" ).load( "etc/sys_user_config.html" );
   } else {
       $( "#configbody" ).load( "etc/sys_register.html" );
   }
   $( ".modalDialog" ).addClass( "modalDialog_on" );
});

function closeModal()
{
   $( ".modalDialog" ).removeClass( "modalDialog_on" );
   setTimeout(function(){
       $( "#configbody" ).html( "" );
   }, 400);
}

$( "#closeModal" ).click( function() {
   closeModal();
});

$( "#login" ).click( function() {
   $( "#configbody" ).load( "etc/sys_login.html" );
   $( ".modalDialog" ).addClass( "modalDialog_on" );
});

$( "#files" ).click( function() {
   var s = $( '#_state' );
   var l = s.data( '_logon' );
   if ( l && l.length )
   {
      $( "#configbody" ).load( "etc/sys_file_manager.html" );
      $( ".modalDialog" ).addClass( "modalDialog_on" );
   }
});

$( "#logoff" ).click( function() {
   $( "#configbody" ).load( "etc/sys_logoff.html" );
   $( ".modalDialog" ).addClass( "modalDialog_on" );
});

$( "#register" ).click( function() {
   $( "#configbody" ).load( "etc/sys_register.html" );
   $( ".modalDialog" ).addClass( "modalDialog_on" );
});

function syncState()
{
   var s = $( '#_state' );
   var l = s.data( '_logon' );
   var ll = s.data( '_logon:last' );
   if ( !ll || l != ll )
   {
      if ( l && l.length )
      {
          $( "#login" ).html( "" );
          $( "#logoff" ).html( "Logoff " + l );
          $( "#files" ).show();
//          $( "#register" ).html( "" );
//          $( "#userconfig" ).html( "<img src=\"etc/config.png\" width=40px id=\"config\" class=\"config\">" );
      } else {
          $( "#login" ).html( "Login" );
          $( "#logoff" ).html( "" );
          $( "#sel_project" ).html( "" );
          $( "#files" ).hide();
//          $( "#register" ).html( "Register" );
      }
      s.data( '_logon:last', l );
   }
   var p = s.data( '_project' );
   var pl = s.data( '_project:last' );
   if ( !pl || p != pl )
   {
      if ( p && p.length )
      {
          $( "#sel_project" ).html( "Project " + p );
      } else {
          $( "#sel_project" ).html( "" );
      }
      s.data( '_project:last', p );
   }
}

$.getJSON( "ajax/sys_config/sys_status.php", {
tags: "_logon",
tagmode: "any",
format: "json"
})
.done(function( data ) {
$( '#_state' ).data( "_logon", data[ "_logon" ] );
syncState();
});

</script>
</body>
</html>
