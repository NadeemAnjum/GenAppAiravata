<form id="calculate_2">
<span id="calculate_2_input_area"></span>
<script>
{
   var t = $( "#global_data" ).data( "repeats" );
   if ( t != undefined ) {
      $( "#global_data" ).removeData( "repeats" );
   }
   t = new Object();
   $( "#global_data" ).data( "repeats", t );
}
{
   var t = $( "#global_data" ).data( "repeats_eval" );
   if ( t != undefined ) {
      $( "#global_data" ).removeData( "repeats_eval" );
   }
   t = new Object();
   $( "#global_data" ).data( "repeats_eval", t );
}
input_eval = "";
input_html = "<table>";
input_repeats = "";
input_trees = [];
skipped_row = 0;
clearPull();
this_html = '<tr><td><label for="input1">Input value 1 </label></td><td><input type="number" name="input1" id="input1" value="0" min="0" max="1e+50" required class="help_link"><span class="help">This field can have values from 0 to 1e50 and is of the float type and it will be the value of input1 in the executable received json</span><span id="input1_msg" class="warning" > </span></td></tr>';
this_eval = 
'setLastValue( "calculate_2", "#input1" );'
 + '$( "#input1" ).blur( function() { checkFloat( "#input1" ); });'
 + '$( "#input1" ).keypress( function() { $( "#input1_msg" ).html( "" ); });';
if ( skipped_row == 1 ){ this_html = this_html.replace(/^<tr>/, "" ); skipped_row=0;};


input_html += this_html;
input_eval += this_eval;
this_html = '<tr><td><label for="input2">Input value 2 </label></td><td><input type="number" name="input2" id="input2" value="1" min="-10" max="10" class="help_link"><span class="help">This field can have values from -10 to 10 and is of the integer type  and it will be the value of input2 in the executable received json</span><span id="input2_msg" class="warning" > </span></td></tr>';
this_eval = 
'setLastValue( "calculate_2", "#input2" );'
 + '$( "#input2" ).blur( function() { checkInt( "#input2" ); });'
 + '$( "#input2" ).keypress( function() { $( "#input2_msg" ).html( "" ); });'
 ;

if ( skipped_row == 1 ){ this_html = this_html.replace(/^<tr>/, "" ); skipped_row=0;};


input_html += this_html;
input_eval += this_eval;
this_html = '<tr><td><label for="input3" class="highlight">Input value 3 </label></td><td><input type="checkbox" name="input3" id="input3" checked class="help_link"><span class="help">This field can have values checked or not checked.  If checked, the executable json input will have an input3 with value on</span></td></tr>';
this_eval = 
'setLastValue( "calculate_2", "#input3" );'

;
;
;
if ( skipped_row == 1 ){ this_html = this_html.replace(/^<tr>/, "" ); skipped_row=0;};


input_html += this_html;
input_eval += this_eval;
this_html = '<tr><td><label for="input4">1st listbox </label></td><td><select id="input4" name="input4" class="help_link"><option value="c1">choice 1</option><option value="c2">choice 2</option><option value="c3">choice 3</option><option value="c4">choice 4</option></select>'
+ '<span class="help">This field is a listbox and depending on the choice, different fields will display below</span>'
+ '</td></tr>';
this_eval = 
'$( "#input4" ).attr( "value", $( "#input4" ).val() );' +
'setLastValue( "calculate_2", "#input4", "c2" );'
 + '$( "#input4" ).change( function() { updateRepeatsLb( "calculate_2", "#input4" ); } );';
 input_repeats += '$( "#global_data" ).data( "calculate_2:#input4:repeat:count", 0 );updateRepeatsLb( "calculate_2", "#input4" );'
if ( skipped_row == 1 ){ this_html = this_html.replace(/^<tr>/, "" ); skipped_row=0;};


input_html += this_html;
input_eval += this_eval;
this_html = '<tr><td><label for="input3c1" class="highlight">Input value 4 c1 </label></td><td><input type="checkbox" name="input3c1" id="input3c1" checked class="help_link"><span class="help">This field is a checkbox that only appears when input4 above is set to choice 1 or c1</span></td></tr>';
this_eval = 
'setLastValue( "calculate_2", "#input3c1" );'

;
;
;
if ( skipped_row == 1 ){ this_html = this_html.replace(/^<tr>/, "" ); skipped_row=0;};

{var t = $( "#global_data" ).data( "repeats" );t[ "#input3c1" ] = this_html;$( "#global_data" ).data( "repeats", t );this_html='<tr><td></td><td><span id="input3c1-span"></span></td></tr>';}{var t = $( "#global_data" ).data( "repeats_eval" );t[ "#input3c1" ] = this_eval;$( "#global_data" ).data( "repeats_eval", t );this_eval='addRepeat("calculate_2", "#input3c1", "#input4:c1" );';}
input_html += this_html;
input_eval += this_eval;
this_html = '<tr><td><label for="input3c2" class="highlight">Input value 4 c2 </label></td><td><input type="checkbox" name="input3c2" id="input3c2" checked class="help_link"><span class="help">This field is a checkbox that only appears when input4 above is set to choice 2 or c2</span></td></tr>';
this_eval = 
'setLastValue( "calculate_2", "#input3c2" );'

;
;
;
if ( skipped_row == 1 ){ this_html = this_html.replace(/^<tr>/, "" ); skipped_row=0;};

{var t = $( "#global_data" ).data( "repeats" );t[ "#input3c2" ] = this_html;$( "#global_data" ).data( "repeats", t );this_html='<tr><td></td><td><span id="input3c2-span"></span></td></tr>';}{var t = $( "#global_data" ).data( "repeats_eval" );t[ "#input3c2" ] = this_eval;$( "#global_data" ).data( "repeats_eval", t );this_eval='addRepeat("calculate_2", "#input3c2", "#input4:c2" );';}
input_html += this_html;
input_eval += this_eval;
this_html = '<tr><td><label for="input3c2b">Input value 4 c2b </label></td><td><input type="number" name="input3c2b" id="input3c2b" class="help_link"><span class="help">This field is an integer that only appears when input4 above is set to choice 2 or c2</span><span id="input3c2b_msg" class="warning" > </span></td></tr>';
this_eval = 
'setLastValue( "calculate_2", "#input3c2b" );'
 + '$( "#input3c2b" ).blur( function() { checkInt( "#input3c2b" ); });'
 + '$( "#input3c2b" ).keypress( function() { $( "#input3c2b_msg" ).html( "" ); });'
 ;

if ( skipped_row == 1 ){ this_html = this_html.replace(/^<tr>/, "" ); skipped_row=0;};

{var t = $( "#global_data" ).data( "repeats" );t[ "#input3c2b" ] = this_html;$( "#global_data" ).data( "repeats", t );this_html='<tr><td></td><td><span id="input3c2b-span"></span></td></tr>';}{var t = $( "#global_data" ).data( "repeats_eval" );t[ "#input3c2b" ] = this_eval;$( "#global_data" ).data( "repeats_eval", t );this_eval='addRepeat("calculate_2", "#input3c2b", "#input4:c2" );';}
input_html += this_html;
input_eval += this_eval;
this_html = '<tr><td><label for="input3c3b">Input value 4 c3b </label></td><td><select id="input3c3b" name="input3c3b" class="help_link"><option value="c1">choice 1</option><option value="c2">choice 2</option><option value="c3">choice 3</option><option value="c4">choice 4</option></select>'
+ '<span class="help">This field is a listbox that only appears when input4 above is set to choice 3 or c3</span>'
+ '</td></tr>';
this_eval = 
'$( "#input3c3b" ).attr( "value", $( "#input3c3b" ).val() );' +
'setLastValue( "calculate_2", "#input3c3b" );'
;

if ( skipped_row == 1 ){ this_html = this_html.replace(/^<tr>/, "" ); skipped_row=0;};

{var t = $( "#global_data" ).data( "repeats" );t[ "#input3c3b" ] = this_html;$( "#global_data" ).data( "repeats", t );this_html='<tr><td></td><td><span id="input3c3b-span"></span></td></tr>';}{var t = $( "#global_data" ).data( "repeats_eval" );t[ "#input3c3b" ] = this_eval;$( "#global_data" ).data( "repeats_eval", t );this_eval='addRepeat("calculate_2", "#input3c3b", "#input4:c3" );';}
input_html += this_html;
input_eval += this_eval;
this_html = '<tr><td><label for="input3c3" class="highlight">Input value 4 c3 </label></td><td><input type="checkbox" name="input3c3" id="input3c3" checked class="help_link"><span class="help">This field is a checkbox that only appears when input4 above is set to choice 3 or c3</span></td></tr>';
this_eval = 
'setLastValue( "calculate_2", "#input3c3" );'

;
;
;
if ( skipped_row == 1 ){ this_html = this_html.replace(/^<tr>/, "" ); skipped_row=0;};

{var t = $( "#global_data" ).data( "repeats" );t[ "#input3c3" ] = this_html;$( "#global_data" ).data( "repeats", t );this_html='<tr><td></td><td><span id="input3c3-span"></span></td></tr>';}{var t = $( "#global_data" ).data( "repeats_eval" );t[ "#input3c3" ] = this_eval;$( "#global_data" ).data( "repeats_eval", t );this_eval='addRepeat("calculate_2", "#input3c3", "#input4:c3" );';}
input_html += this_html;
input_eval += this_eval;
this_html = '<tr><td><label for="input6">textarea </label></td><td><textarea name="input6" id="input6" rows="4" cols="40" class="help_link"></textarea>'
+ '<span class="help">enter some text</span>'
+ '<span id="input6_msg" class="warning" > </span></td></tr>';
this_eval = '  if ( $( "#global_data" ).data( "calculate_2:input6:last_value" ) == undefined ) { $( "#input6" ).attr( "value", "this is a text areamultiline" ).val( "this is a text areamultiline" );  } ' +
'setLastValue( "calculate_2", "#input6" );' +
'$( "#input6" ).keypress( function() { $( "#input6_msg" ).html( "" ); });';
if ( skipped_row == 1 ){ this_html = this_html.replace(/^<tr>/, "" ); skipped_row=0;};


input_html += this_html;
input_eval += this_eval;
this_html = '<tr><td><label for="input7a" class="highlight">Radiobutton a </label></td><td><input type="radio" name="input7" id="input7a" value="input7a" class="help_link"><span class="help">radio button a help</span></td></tr>';
this_eval = 'setLastValue( "calculate_2", "#input7a" );';
if ( skipped_row == 1 ){ this_html = this_html.replace(/^<tr>/, "" ); skipped_row=0;};


input_html += this_html;
input_eval += this_eval;
this_html = '<tr><td><label for="input7b" class="highlight">Radiobutton b </label></td><td><input type="radio" name="input7" id="input7b" value="input7b" class="help_link"><span class="help">radio button b help</span></td></tr>';
this_eval = 'setLastValue( "calculate_2", "#input7b" );';
if ( skipped_row == 1 ){ this_html = this_html.replace(/^<tr>/, "" ); skipped_row=0;};


input_html += this_html;
input_eval += this_eval;
this_html = '<tr><td><label for="input7c" class="highlight">Radiobutton c </label></td><td><input type="radio" name="input7" id="input7c" value="input7c" checked class="help_link"><span class="help">radio button c help</span></td></tr>';
this_eval = 'setLastValue( "calculate_2", "#input7c" );';
if ( skipped_row == 1 ){ this_html = this_html.replace(/^<tr>/, "" ); skipped_row=0;};


input_html += this_html;
input_eval += this_eval;
if( skipped_row == 1 ){ input_html += "</tr>"; }
input_html += '</table>';
$( '#calculate_2_input_area' ).html( input_html );
eval( input_eval );
</script>
<p><button id="calculate_2_submit"><span class="buttontext">Submit</span></button>
<button id="calculate_2_reset"><span class="buttontext">Reset to default values</span></button>

</p>
<span id="calculate_2_progress"></span>
<script>


//function progressHandlingFunction(e){
//    if(e.lengthComputable){
//        $('#calculate_2_progress progress').attr({value:e.loaded,max:e.total});
//    }
//}

$( "#calculate_2_submit" ).click( function() {
    $( "#calculate_2_results" ).text( "" );
    var output_msgs = $("#calculate_2_output #msgs");
    output_msgs.text( "" );

    saveLastValues( "calculate_2" );
    resetDefaultValues( "calculate_2_output" );

    var found_errors = 0;
    $("#calculate_2").find("input").each(function(i){
//      console.log("values:" + $(this).attr('id') + " required:" + $(this).attr( 'required' ) +  
//      " val:" + $(this).val() + " val-len:" + $(this).val().length
//      );
//      if ( $(this).attr( 'multiple' ) )
//      {
//         var filelist = document.getElementById( $(this).attr( 'id' ) ).files || [];
//         for ( var i = 0; i < filelist.length; ++i )
//         {                               
//              console.log(" file " + i + " " + filelist[i].name );
//         }
//      }
      if ( $(this).attr( 'required' ) && $(this).val().length == 0 )
      {
          var tag =  "#calculate_2 " + "#" + $(this).attr('id') + "_msg";

          $( tag ).html( "missing required field" );
          found_errors = 1;
      }
    });
    if ( found_errors )
    {
        return false;
    }

    var tree_html = "";
    $( "._hidden_tree_selects" ).remove( );
    $.each( input_trees, function( k, v ){

        $( 'input[type=hidden][name="' + v + '[]"]' ).remove();
        var selectedElms = $('#' + v).jstree("get_selected", true);
        var i = 0;
        $.each(selectedElms, function() {
           tree_html += '<input type="hidden" name="' + v + '[]" value="' + this.id + '" class="_hidden_tree_selects"/>';

        });
    });

    $( this ).append( tree_html );


    var logonadd = $("<input>").attr("type", "hidden").attr("name", "_logon").val( $( "#_state" ).data( "_logon" ) );$( this ).append($(logonadd));
    var projectadd = $("<input>").attr("type", "hidden").attr("name", "_project").val( $( "#_state" ).data( "_project" ) );$( this ).append($(projectadd));
    var vuuid = uuid.v1();
    console.log( "uuid:" + vuuid );
    var uuidadd = $("<input>").attr("type", "hidden").attr("name", "_uuid").val( vuuid );$( this ).append($(uuidadd));
    function msg_calculate_2 ( id, data )
    {
       $('#calculate_2_progress').html( "" );
       output_msgs.text( "" );
       var appended = 0;
//       var json = jQuery.parseJSON( data );
//       $.each(data, function(k0, v0) {
//           if ( k0 == 'json' )
//           {
              $.each( data, function(k, v) {

                var match = $( "#calculate_2_output" ).find( "#" + k );
                if ( match.length )
                {
                    switch ( match.attr( "type" ) )
                    {
                       case "plot2d" : $.plot( match, v, gd.data( "_plot_options" ) ); 
                                       var savekey = "calculate_2_output:#" + k + ":last_value";
                                       $( "#global_data" ).data( savekey , v ); 
                                       break;
                       case "checkbox" : 
                       case "radio" : 
                               match.prop( "checked", true ); break;
                       case "div" :  match.html( v ); break;
                       case "filelink" : 
                               var tlink = "<a href=\"" + v + "\">" + v.split( '/' ).pop() + "</a>";
                               var savekey = "calculate_2_output:#" + k + ":last_value";
                               $( "#global_data" ).data( savekey , tlink );
                               $( "#" + k + "_filelink" ).html( tlink );
                                break;
                       case "filelinkm" : 
                               var savekey = "calculate_2_output:#" + k + ":last_value";
                               var tlink = "";
                               $.each( v, function( k2, v2 ) {
                                   tlink += "<a href=\"" + v2 + "\">" + v2.split( '/' ).pop() + "</a> ";
                               } );
                               $( "#global_data" ).data( savekey , tlink );
                               $( "#" + k + "_filelink" ).html( tlink );
                               break;
                       default : 
                          if ( $( "#global_data" ).data( "_append:calculate_2_output_" + k ) )
                          {
                             match.val( match.val() + "\n" + v );
                             match.height( parseFloat( match.prop( 'scrollHeight' ) + parseFloat( match.css("borderTopWidth" ) ) + parseFloat( match.css("borderBottomWidth") ) ) );
                          } else {
                             match.val( v );
                          }
                          break;
                    }
                } else {
                    if ( k.charAt( 0 ) != "_" )
                    {
                       if ( !appended )
                       {
                           output_msgs.append( "<p>Unexpected results:</p>" );
                           appended = 1;
                       }
                       output_msgs.append( "<p>" + k + " => " + v + "</p>" );
                    }
                } 
             });
//          }
//       });
    }

    subMsging( vuuid, msg_calculate_2 );

    var formData = new FormData($('form')[0]);


    $('#calculate_2_progress').html( "Uploading:<progress></progress>" );
    $.ajax( {
             dataType: "json",
             cache:false,
//             timeout:3000,  // for testing
             type:"POST",
             url:"ajax/calculate/calculate_2.php",
             data: formData,
             xhr: function() {  // Custom XMLHttpRequest
                 var myXhr = $.ajaxSettings.xhr();
                 if(myXhr.upload){ // Check if upload property exists
                     myXhr.upload.addEventListener('progress',
                         function(e) {
                         if(e.lengthComputable){
                           $('#calculate_2_progress progress').attr({value:e.loaded,max:e.total});
                         } }
//                     progressHandlingFunction
                    , false);
                 }
                 return myXhr;
             },
             contentType: false,
             processData: false
            } )
    .done( function( data, status, xhr ) {




// loop through data pairs
           output_msgs.text( "" );
           var appended      = 0;
           var state_changed = 0;
           var do_close      = 0;
           $.each(data, function(k, v) {
           

               var match = $( "#calculate_2_output" ).find( "#" + k );
               if ( match.length )
               {
                   switch ( match.attr( "type" ) )
                   {
                       case "plot2d" : $.plot( match, v, gd.data( "_plot_options" ) ); 
                               var savekey = "calculate_2_output:#" + k + ":last_value";
                               $( "#global_data" ).data( savekey , v ); 
                               break;
                       case "checkbox" : 
                       case "radio" : 
                               match.prop( "checked", true ); break;
                       case "div" :  match.html( v ); break;
                       case "filelink" : 
                               var tlink = "<a href=\"" + v + "\">" + v.split( '/' ).pop() + "</a>";
                               var savekey = "calculate_2_output:#" + k + ":last_value";
                               $( "#global_data" ).data( savekey , tlink );
                               $( "#" + k + "_filelink" ).html( tlink );
                               break;
                       case "filelinkm" : 
                               var savekey = "calculate_2_output:#" + k + ":last_value";
                               var tlink = "";
                               $.each( v, function( k2, v2 ) {
                                   tlink += "<a href=\"" + v2 + "\">" + v2.split( '/' ).pop() + "</a> ";
                               } );
                               $( "#global_data" ).data( savekey , tlink );
                               $( "#" + k + "_filelink" ).html( tlink );
                               break;
                       default :
                          if ( $( "#global_data" ).data( "_append:calculate_2_output_" + k ) )
                          {
                             match.val( match.val() + "\n" + v );
                             match.height( parseFloat( match.prop( 'scrollHeight' ) + parseFloat( match.css("borderTopWidth") ) + parseFloat( match.css("borderBottomWidth") ) ) );
                          } else {
                             match.val( v );
                          }
                          break;
                   }
               } else {
                     if ( k.charAt( 0 ) == "_" )
                     {
                        $( "#_state" ).data( k, v );
                        state_changed = 1;
                     } else {
                        if ( k == "-close" )
                        {
                           do_close = 1;
                        } else {
                           if ( !appended )
                           {
                              output_msgs.append( "<p>Unexpected results:</p>" );
                              appended = 1;
                           }
                           output_msgs.append( "<p>" + k + " => " + v + "</p>" );
                       }
                   }
               }
           });
           saveLastValues( "calculate_2_output" );
           saveLastValue( "calculate_2_output", "#msgs" );
           $('#calculate_2_progress').html( "" );
           if ( state_changed )
           {
               syncState();
           }
           if ( do_close )
           {
               closeModal();
           }
           unsubMsging( vuuid );
          } )
    .fail( function( xhr, status, errorThrown ) {




           $( "#calculate_2_results" ).html( "<span class=\"warning\"> Failed: " + status + " : '" + xhr.status + ":" + errorThrown + "' on URL ajax/calculate/calculate_2.php </span>" );
           $('#calculate_2_progress').html( "" );
           unsubMsging( vuuid );
          } );
    return false;
});
$( "#calculate_2_reset" ).click( function() {
    resetDefaultValues( "calculate_2" );
    resetDefaultValues( "calculate_2_output" );
    resetDefaultValue( "calculate_2_output", "#msgs" );
    eval( input_repeats );
    return false;
});
setHoverHelp();


eval( input_repeats );
doPull();
</script>
</form>
<div id="calculate_2_results"></div>
<hr>
<form id="calculate_2_output">
<div id="msgs" class="warning" type="msgs"></div>
<script>
setLastValue( "calculate_2_output", "#msgs" );
$( "#global_data" ).data( "_extra_resets", [] );
</script>
<table>
<tr><td><label for="output1">Output value 1 </label></td><td><input type="number" name="output1" id="output1" readonly class="help_link"><span class="help">This field is a float value that is the result of the submission</span></td></tr>
<script>
setLastValue( "calculate_2_output", "#output1" );
</script>
<tr><td><label for="outputref" class="help_link">input json reference </label>
<span class="help">This field is a file link that holds the input json reference sent to the executable</span></td>
<td><div id="outputref" type="filelink" readonly class="help_link"><span id="outputref_filelink"></span></div>
<span class="help">This field is a file link that holds the input json reference sent to the executable</span></td></tr>
<script>
setLastValue( "calculate_2_output", "#outputref" );
$( "#global_data" ).data( "_extra_resets" ).push( "outputref" );
</script>
<tr><td><label for="outputres" class="help_link">results json reference </label>
<span class="help">This field is a file link that holds the output json retrieved from the executable</span></td>
<td><div id="outputres" type="filelink" readonly class="help_link"><span id="outputres_filelink"></span></div>
<span class="help">This field is a file link that holds the output json retrieved from the executable</span></td></tr>
<script>
setLastValue( "calculate_2_output", "#outputres" );
$( "#global_data" ).data( "_extra_resets" ).push( "outputres" );
</script>
<tr><td><label for="output2a">Radio output 2a </label></td><td><input type="radio" name="output2" id="output2a" value="output2a" disabled class="help_link"><span class="help">output radio 2a</span></td></tr>
<script>
setLastValue( "calculate_2_output", "#output2a" );
</script>
<tr><td><label for="output2b">Radio output 2b </label></td><td><input type="radio" name="output2" id="output2b" value="output2b" disabled class="help_link"><span class="help">output radio 2b</span></td></tr>
<script>
setLastValue( "calculate_2_output", "#output2b" );
</script>
<tr><td><label for="output2c">Radio output 2c </label></td><td><input type="radio" name="output2" id="output2c" value="output2c" disabled class="help_link"><span class="help">output radio 2c</span></td></tr>
<script>
setLastValue( "calculate_2_output", "#output2c" );
</script>
<tr><td><label for="output3">checkbox out 3 </label></td><td><input type="checkbox" name="output3" id="output3" disabled class="help_link"><span class="help">output checkbox 3</span></td></tr>
<script>
setLastValue( "calculate_2_output", "#output3" );
</script>
<tr><td><label for="output4">checkbox out 4 </label></td><td><input type="checkbox" name="output4" id="output4" disabled class="help_link"><span class="help">output checkbox 4</span></td></tr>
<script>
setLastValue( "calculate_2_output", "#output4" );
</script>
<tr><td><label for="output5">output textarea </label></td><td><textarea name="output5" id="output5" rows="6" cols="60" readonly class="help_link"></textarea>
<span class="help">output textarea</span></td></tr>
<script>

setLastValue( "calculate_2_output", "#output5" );
</script>
</table>
</form>
